---
import Welcome from "../components/Welcome.astro";
import Layout from "../layouts/Layout.astro";

// Welcome to Astro! Wondering what to do next? Check out the Astro documentation at https://docs.astro.build
// Don't want to use any of this? Delete everything in this file, the `assets`, `components`, and `layouts` directories, and start fresh.
---

<Layout>
	
	<h1>My Awesome Chat</h1>
	<form id="chat-form">
		<input type="text" id="username">
		<input type="text" id="chat-message">
		<button>Send</button>
	</form>

	<ul id="messages">
		<!-- CHAT MESSAGES GO HERE -->
	</ul>

	<script type="module">
		import { io } from "https://cdn.socket.io/4.8.1/socket.io.esm.min.js";

		const socket = io('http://localhost:3500') // backend url

		socket.on('connect', () => {
  console.log('Connected to server:', socket.id);
});

		const inputUsername = document.querySelector('#username')
		const inputMessage = document.querySelector('#chat-message')

		const form = document.querySelector('#chat-form')

		form.addEventListener('submit', (e) => {
			e.preventDefault()

			socket.emit('chat', {
				username: inputUsername.value,
				message: inputMessage.value
			})
		})

		// Listening for new messages on chat event
		socket.on('chat', (data) => {
			const messages = document.querySelector('#messages')
			const li = document.createElement('li')
			li.innerHTML = `<span style="${data.username === inputUsername.value ? 'color: green' : 'color: black'}">${data.username ?? 'System'}:</span> ${data.message}`
			messages.appendChild(li)
		})
	</script>

</Layout>